@startuml

skinparam SequenceMessageAlignment center
skinparam SequenceArrowColor Black
skinparam SequenceLifeLineBorderColor Black

skinparam NoteTextAlignment center
skinparam NoteBackgroundColor White
skinparam NoteBorderColor<<black>> Black
skinparam NoteBorderColor<<red>> Red

skinparam ParticipantPadding 70
skinparam ParticipantBorderColor Black
skinparam ParticipantBackgroundColor White

skinparam Padding 1
skinparam Shadowing<<note>> false
skinparam DefaultFontName Helvetica Neue


participant "Evil UE" as evilUE
participant "Target UE" as UE
participant SEAF
participant AUSF
participant "UDM/ARPF/\nSIDF" as UDM


UE -> SEAF : N1 message\n//**(SUCI or 5G GUTI)**//

...

rnote <<note>> <<black>> over evilUE
**[1]** Evesdrop on the N1 message
end note

rnote <<note>> <<black>> over evilUE
**[2]** Purchase USIM from the same Home Network
end note

rnote <<note>> <<black>> over evilUE
**[3]** Compromise USIM and extract K
end note

autonumber 4 "<b>[0]"

evilUE -> SEAF : N1 message\n//**(SUCI of the Target UE)**//

SEAF -> AUSF : Nausf_UEAuthentication_Authenticate\nRequest //**(SUCI of the Target UE, SN-Name)**//

AUSF -> UDM : Nudm_UEAuthentication_Get\nRequest //**(SUCI of the Target UE, SN-Name)**//

rnote <<note>> <<black>> over UDM
**[7]** Deconceal SUCI  and generate
 Authentication Vector for the Target UE
end note

autonumber 8 "<b>[0]" 

evilUE -> SEAF : N1 message\n//**(SUCI of the Evil UE)**//

SEAF -> AUSF : Nausf_UEAuthentication_Authenticate\nRequest //**(SUCI of the Evil UE, SN-Name)**//

AUSF -> UDM : Nudm_UEAuthentication_Get\nRequest //**(SUCI of the Evil UE, SN-Name)**//

rnote <<note>> <<black>> over UDM
**[11]** Deconceal SUCI  and generate
Authentication Vector for the Evil UE
end note

autonumber 12 "<b>[0]"

UDM -> AUSF : Nudm_Authentication_Get\nResponse //**(5G HE AV, [SUPI of the Evil UE])**//

rnote <<note>> <<red>> over AUSF
**[13]** Assign response to the request
with the SUCI of the Target UE
end note

...

autonumber 14 "<b>[0]"

SEAF -> evilUE : Authentication Request

rnote <<note>> over evilUE
**[15]** Calculate Response
end note

autonumber 16 "<b>[0]"

evilUE -> SEAF : Authentication Response

...

AUSF -> SEAF : Nausf_UEAuthentication_Authenticate Response\n//**(Result: Successful,**//\n//**[SUPI of the Target UE], Kseaf of the Evil UE)**//

@enduml